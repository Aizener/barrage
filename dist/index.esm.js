var Barrage=function(){function t(t){this.list=[],this.rId=0,this.isListen=!1,this.listenerTimer=null,this.maxMessage=1500,this.cvs=document.createElement("canvas");t=document.querySelector(t);if(!t)throw new Error("ReferenceError: selector is not exist.");this.target=t,this.init()}return t.prototype.run=function(){this.handleListenr()},t.prototype.addMessage=function(t){if(!(this.list.length>2*this.maxMessage)){var i=t.style||{},e=i.fontSize,s=void 0===e?"20px":e,n=i.fontFamily,r=void 0===n?"Microsoft YaHei":n,e=i.color,n=void 0===e?"#fff":e;t.speed||(t.speed=3);i=this.getPositoin(parseInt(s)),e=i[0],i=i[1];return this.pushMessage({x:e,y:i,id:String(Math.ceil(1e3*Math.random()))+i+t.speed*i,text:t.text,speed:t.speed,style:{color:n,fontSize:s,fontFamily:r}}),this}},t.prototype.addMessages=function(t){var i=this;return t.forEach(function(t){return i.addMessage(t)}),this},t.prototype.clear=function(){this.list=[],this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height)},t.prototype.stop=function(){this.listenerTimer&&clearInterval(this.listenerTimer),this.listenerTimer=null,this.rId&&cancelAnimationFrame(this.rId)},t.prototype.init=function(){var t=this.target.offsetWidth,i=this.target.offsetHeight;this.cvs.width=t,this.cvs.height=i,this.target.setAttribute("style","position: relative;"),this.cvs.setAttribute("style","position: absolute; pointer-events: none; left: 0; top: 0; z-index: 9999;"),this.ctx=this.cvs.getContext("2d"),this.target.appendChild(this.cvs)},t.prototype.pushMessage=function(t){this.list.push(t)},t.prototype.getPositoin=function(t){var i=this.cvs.width,t=Math.random()*(this.cvs.height-t);return[Math.floor(i),Math.floor(t)]},t.prototype.handleListenr=function(){var t=this;this.isListen||(this.isListen=!0,this.list.length?this.handleAnimate():this.listenerTimer=setInterval(function(){t.handleAnimate()},1e3))},t.prototype.handleAnimate=function(){0<this.list.length&&(this.rId&&cancelAnimationFrame(this.rId),this.animate(),this.isListen=!1,this.listenerTimer&&clearInterval(this.listenerTimer))},t.prototype.animate=function(){var e=this;if(!this.list.length)return this.rId&&cancelAnimationFrame(this.rId),void this.handleListenr();this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height);for(var t=[],i=0,s=this.list.slice(0,this.maxMessage);i<s.length;i++){var n,r,h,o=s[i];o.x-=o.speed,o.x>=this.cvs.width||(h=(r=o.style).color,n=r.fontSize,r=r.fontFamily,this.ctx.beginPath(),this.ctx.font="".concat(n," ").concat(r),this.ctx.fillStyle=h,this.ctx.fillText(o.text,o.x,o.y+parseInt(o.style.fontSize)),h=this.ctx.measureText(o.text).width,o.x<=-h&&t.push(o.id))}t.forEach(function(i){var t=e.list.findIndex(function(t){return t.id===i});0<t&&e.list.splice(t,1)}),this.rId=requestAnimationFrame(this.animate.bind(this))},t}();export{Barrage as default};
