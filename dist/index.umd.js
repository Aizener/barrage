!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Barrage=e()}(this,function(){"use strict";function d(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,o=i.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)s.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s}function t(t){this.cvs=document.createElement("canvas");t=document.querySelector(t);if(!t)throw new Error("ReferenceError: selector is not exist.");this.target=t,this.list=[],this.init()}return t.prototype.run=function(){this.rId&&cancelAnimationFrame(this.rId),this.animate()},t.prototype.addMessage=function(t){var e=t.style||{},i=e.fontSize,r=void 0===i?"20px":i,n=e.fontFamily,o=void 0===n?"Microsoft YaHei":n,i=e.color,n=void 0===i?"#fff":i,e=d(this.getPositoin(parseInt(r)),2),i=e[0],e=e[1];return this.list.push({x:i,y:e,id:String(Math.ceil(1e3*Math.random()))+e+t.speed*e,text:t.text,speed:t.speed||3,style:{color:n,fontSize:r,fontFamily:o}}),this},t.prototype.addMessages=function(t){var e=this;return t.forEach(function(t){return e.addMessage(t)}),this},t.prototype.init=function(){var t=this.target.offsetWidth,e=this.target.offsetHeight;this.cvs.width=t,this.cvs.height=e,this.target.setAttribute("style","position: relative;"),this.cvs.setAttribute("style","position: absolute; pointer-events: none; left: 0; top: 0; z-index: 9999;"),this.ctx=this.cvs.getContext("2d"),this.target.appendChild(this.cvs)},t.prototype.getPositoin=function(t){var e=this.cvs.width,t=Math.random()*(this.cvs.height-t);return[Math.floor(e),Math.floor(t)]},t.prototype.animate=function(){var e,t;if(this.list.length){this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height);var i=[];try{for(var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.list.entries()),n=r.next();!n.done;n=r.next()){var o,s,a,h,l,c=d(n.value,2),f=(c[0],c[1]);f.x-=f.speed,f.x>=this.cvs.width||(s=(o=f.style).color,a=o.fontSize,h=o.fontFamily,this.ctx.beginPath(),this.ctx.font="".concat(a," ").concat(h),this.ctx.fillStyle=s,this.ctx.fillText(f.text,f.x,f.y+parseInt(f.style.fontSize)),l=this.ctx.measureText(f.text).width,f.x<=-l&&i.push(f.id))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.list=this.list.filter(function(t){return!i.includes(t.id)}),this.rId=requestAnimationFrame(this.animate.bind(this))}else this.rId&&cancelAnimationFrame(this.rId)},t});
